<!DOCTYPE html>
<html>
  <head>
    <title>Production Experiment</title>
    <script src="https://unpkg.com/jspsych@7.3.4"></script>
    <script src="https://unpkg.com/@jspsych/plugin-survey-text@1.1.3"></script>
    <script src="../plugin/plugin-html-multi-slider-response.js"></script>
    <script src="../plugin/plugin-html-button-response.js"></script>
    <script src="../plugin/plugin-fullscreen.js"></script>
    <link href="https://unpkg.com/jspsych@7.3.4/css/jspsych.css" rel="stylesheet" type="text/css" />
    <style>
      img {
        width: 600px;
      }
    </style>
  </head>
  <body></body>

  <script>

    var jsPsych = initJsPsych({
        show_progress_bar: true,
        auto_update_progress_bar: false, 
        on_trial_start: function() {

            if (jsPsych.getCurrentTrial().data.is_experiment) {
                var progress = jsPsych.getProgress();
                jsPsych.setProgressBar(progress.current_trial_global / progress.total_trials); 
            } else {
                jsPsych.setProgressBar(0); 
            }
        },
        on_finish: function() {
            jsPsych.data.displayData();
        }
      });

    
    var fullscreenFunction = {
      type:jsPsychFullscreen,
      fullscreen_mode: true,
      message: '<p>Please enter fullscreen mode to continue the experiment.</p>',
      button_label: 'Enter Fullscreen',
      delay_after: 1000,
      data: { is_experiment: false }
    }

    var consent_form = {
      type: jsPsychHtmlButtonResponse,
      stimulus: '<p> This is the consent form.(To be edited)</p >',
      choices: ['Continue'],
      data: { is_experiment: false }
    };


    var instruction = {
      type: jsPsychHtmlButtonResponse,
      stimulus: '<p> You are a player in a video game, and your goal is to earn money as quickly as possible. <br> Please follow the instructions to check the condition of your characters.</p >',
      choices: ['Continue'],
      data: { is_experiment: false }
    };
    
    
    var instruction_energy = {
      type: jsPsychHtmlButtonResponse,
      stimulus: '<img src="images_production/instruction_energy.png" style="width:500px; height:auto; margin: 30px auto;">' +
        '<p> In the first part of the experiment, you will see screenshots like the one above that indicate how much energy your character has left.<br> On the following pages, the condition description will be incomplete.<br> Please use the sliders to indicate how likely you think it is that the screen would show the different statements.<br> If you think none of the options are likely, you can assign a high rating to the <emph>something else</emph> option.</p >',
      choices: ['Continue'],
      data: { is_experiment: true }
    };

    var instruction_pet = {
      type: jsPsychHtmlButtonResponse,
      stimulus: '<img src="images_production/instruction_pet.png" style="width:500px; height:auto; margin: 30px auto;">' +
      '<p>In the second part of the experiment, you will see screenshots like the one above that indicate how well-fed your pet is.<br> Again, please use the sliders to indicate how likely you think it is that the screen would show the different statements.</p >',
      choices: ['Continue'],
      data: { is_experiment: true }
    };

    var instruction_wealth = {
      type: jsPsychHtmlButtonResponse,
      stimulus: '<img src="images_production/instruction_wealth.png" style="width:500px; height:auto; margin: 30px auto;">' +
      '<p> In the last part of the experiment, you will see screenshots like the one above that indicate how wealthy your character is.<br> Please use the sliders to indicate how likely you think it is that the screen would show the different statements.</p >',
      choices: ['Continue'],
      data: { is_experiment: true }
    };


    function createTrial(imageType, imageNumber, labels) {
    return {
        type: jsPsychHtmlMultiSliderResponse,
        stimulus: `<img src="images_production/${imageType}${imageNumber}.png" style="width:500px; height:auto; margin: 30px auto;">` +
        '<p>How likely do you think the dialogue box will display the following sentences ? <br> Make sure that your responses sum up to 100.</p>',
        num_sliders: 3,
        force_total: 100,
        slider_labels: labels,
        slider_width: 800,
        prompt: '',
        data: { is_experiment: true }
    };
}

    // energy trials
    var energy_trials = [];
    for (let i = 1; i <= 9; i++) {
        energy_trials.push(createTrial('energy', i, ["Your character is tired", "Your character is exhausted", "<em>something else</em>"]));
    }

    var energy_trials_round2 = [];
    for (let i = 1; i <= 9; i++) {
        energy_trials_round2.push(createTrial('energy', i, ["Your character is tired", "Your character is exhausted", "<em>something else</em>"]));
    }

    // pet trials
    var pet_trials = [];
    for (let i = 1; i <= 9; i++) {
        pet_trials.push(createTrial('pet', i, ["Your pet is hungry", "Your pet is starving", "<em>something else</em>"]));
    }

    var pet_trials_round2 = [];
    for (let i = 1; i <= 9; i++) {
        pet_trials_round2.push(createTrial('pet', i, ["Your pet is hungry", "Your pet is starving", "<em>something else</em>"], ));
    }

    // wealth trials
    var wealth_trials = [];
    for (let i = 1; i <= 9; i++) {
        wealth_trials.push(createTrial('wealth', i, ["Your character is poor", "Your character is destitute", "<em>something else</em>"], ));
    }

    var wealth_trials_round2 = [];
    for (let i = 1; i <= 9; i++) {
        wealth_trials_round2.push(createTrial('wealth', i, ["Your character is poor", "Your character is destitute", "<em>something else</em>"]));
    }

 


    var timeline_energy = [];
    timeline_energy = timeline_energy.concat(energy_trials); // adding first round trials
    timeline_energy = timeline_energy.concat(energy_trials_round2); // adding second trials

    var timeline_pet = [];
    timeline_pet = timeline_pet.concat(pet_trials); // adding first round trials
    timeline_pet = timeline_pet.concat(pet_trials_round2); // adding second trials 


    var timeline_wealth = [];
    timeline_wealth = timeline_wealth.concat(wealth_trials); // adding first round trials
    timeline_wealth = timeline_wealth.concat(wealth_trials_round2); // adding second trials

    var feedback = {
      type: jsPsychSurveyText,
      questions: [
        {prompt: 'If you encountered any technical difficulties, found anything odd,<br> or if you have any other comments about the experiment that you would like to share with us,<br> please type them in the box below:', rows: 5}
      ],
      choices: ['Finish'],
      data: { is_experiment: false }
    }
    
    // randomdized
    var shuffled_timeline_e = jsPsych.randomization.shuffle(timeline_energy);
    var shuffled_timeline_p = jsPsych.randomization.shuffle(timeline_pet);
    var shuffled_timeline_w = jsPsych.randomization.shuffle(timeline_wealth);

    timeline = [fullscreenFunction].concat(consent_form, instruction, instruction_energy, shuffled_timeline_e, instruction_pet, shuffled_timeline_p, instruction_wealth, shuffled_timeline_w, feedback)


    // run
    jsPsych.run(timeline);


  </script>
</html>